name: Deploy Frontend UI

on:
  push:
    branches:
      - main
    paths:
      - 'frontend/**'
      - '.github/workflows/deploy-frontend.yml'

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Install dependencies
      working-directory: ./frontend
      run: npm ci

    - name: Build
      working-directory: ./frontend
      run: npm run build
      env:
        VITE_AZURE_AD_ENABLED: 'true'
        VITE_AZURE_AD_CLIENT_ID: '8cd494f0-2240-4fb2-979c-d79b392a9ed8'
        VITE_AZURE_AD_AUTHORITY: 'https://login.microsoftonline.com/c1fd05f4-5cd4-463e-b295-9ce7778cfc8d'
        VITE_AZURE_AD_REDIRECT_URI: 'https://app-anthosks-ui-se-01-p.azurewebsites.net'
        VITE_API_SCOPES: 'api://8cd494f0-2240-4fb2-979c-d79b392a9ed8/access_as_user'
        VITE_API_URL: 'https://app-anthosks-api-se-01-p.azurewebsites.net'

    - name: Create deployment package
      working-directory: ./frontend
      run: |
        cd dist
        zip -r ../deploy.zip .

    - name: Deploy to Azure Web App
      uses: azure/webapps-deploy@v3
      with:
        app-name: 'app-anthosks-ui-se-01-p'
        publish-profile: ${{ secrets.AZURE_FRONTEND_PUBLISH_PROFILE }}
        package: ./frontend/deploy.zip
